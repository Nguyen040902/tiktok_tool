<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>TikTok Product Tool</title>

<style>
body {
    font-family: Arial;
    padding: 30px;
}
textarea {
    width: 100%;
    height: 120px;
}
button {
    padding: 10px 25px;
    margin-top: 10px;
    cursor: pointer;
}
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 25px;
}
th, td {
    border: 1px solid #ddd;
    padding: 10px;
    vertical-align: top;
}
th {
    background: #111;
    color: white;
}
img {
    width: 220px;
}
a {
    word-break: break-all;
}
</style>
</head>

<body>

<h2>TikTok Product Tool (Ảnh rõ hơn – Không proxy)</h2>

<textarea id="links" placeholder="Dán mỗi link TikTok 1 dòng"></textarea><br>
<button onclick="run()">LẤY DỮ LIỆU</button>

<table>
<thead>
<tr>
    <th>Tiêu đề</th>
    <th>Ảnh</th>
    <th>Link ảnh</th>
    <th>Link sản phẩm</th>
</tr>
</thead>
<tbody id="result"></tbody>
</table>

<script>
function upscaleImage(url) {
    if (!url) return "";
    return url.replace(/resize-webp:\d+:\d+/, "resize-webp:1080:1080");
}

async function fetchHTML(url) {
    const res = await fetch(url);
    return await res.text();
}

function extractMeta(html, prop) {
    const doc = new DOMParser().parseFromString(html, "text/html");
    const tag = doc.querySelector(`meta[property="${prop}"]`);
    return tag ? tag.content : "";
}

async function run() {
    const links = document.getElementById("links").value.trim().split("\n");
    const table = document.getElementById("result");
    table.innerHTML = "";

    for (let link of links) {
        try {
            const html = await fetchHTML(link);
            const title = extractMeta(html, "og:title");
            let image = extractMeta(html, "og:image");
            image = upscaleImage(image);

            if (title && image) {
                table.innerHTML += `
                <tr>
                    <td>${title}</td>
                    <td><img src="${image}"></td>
                    <td><a href="${image}" target="_blank">${image}</a></td>
                    <td><a href="${link}" target="_blank">${link}</a></td>
                </tr>`;
            }
        } catch (e) {
            console.log("Không lấy được:", link);
        }
    }
}
</script>

</body>
</html>
